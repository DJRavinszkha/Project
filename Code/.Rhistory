?c()
ls()
setRepositories(FALSE, 1:9)
install.packages(c('gplots', 'limma', 'pcaMethods'))
ls()
setRepositories(FALSE, 1:9)
install.packages(c('gplots', 'limma', 'pcaMethods'))
library(pcaMethods)
library(limma)
boxplot()
gxData.raw
boxplot()
boxplot()
ls()
library(gtools)
# 1.1 Import the text file containing the data into a new object 'gxData.raw'
#----------------------------------------------------------------------------#
# HINT: use the first column as rownames in your object.
setwd(DATA.DIR)
# 1.1 Import the text file containing the data into a new object 'gxData.raw'
#----------------------------------------------------------------------------#
# HINT: use the first column as rownames in your object.
setwd(DATA.DIR)
## STEP 1: Set working directory to MSB1005-WGCNA-2019 folder.
Change location to current file location
```{r}
library(rstudioapi)
current_path <- getActiveDocumentContext()$path
setwd(dirname(current_path ))
```
```{r}
library(rstudioapi)
install.packages(c("BiocManager", "igraph", "rstudioapi", "WGCNA"))
```{r}
library(rstudioapi)
current_path <- getActiveDocumentContext()$path
setwd(dirname(current_path ))
library(rstudioapi)
current_path <- getActiveDocumentContext()$path
setwd(dirname(current_path ))
## STEP 2: Packages
Install the required packages if necessary
```{r}
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
#uncomment if not yet installed!
BiocManager::install(c("topGO", "org.Hs.eg.db", "WGCNA", "RCy3", "igraph"))
library(topGO)
library(org.Hs.eg.db)
library(WGCNA)
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
#uncomment if not yet installed!
BiocManager::install(c("topGO", "org.Hs.eg.db", "WGCNA", "RCy3", "igraph"))
library(topGO)
library(org.Hs.eg.db)
library(WGCNA)
install.packages("WGCNA")
install.packages("WGCNA")
source("http://bioconductor.org/biocLite.R")
biocLite("impute")
BiocManager::install("WGCNA")
library(topGO)
library(org.Hs.eg.db)
library(WGCNA)
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
#uncomment if not yet installed!
BiocManager::install(c("topGO", "org.Hs.eg.db", "WGCNA", "RCy3", "igraph"))
#uncomment if not yet installed!
BiocManager::install(c("topGO", "org.Hs.eg.db", "WGCNA", "RCy3", "igraph"))
library(topGO)
library(org.Hs.eg.db)
#library(WGCNA
library(RCy3
library(igraph
library(WGCNA)
library(RCy3)
library(igraph)
options(stringsAsFactors = F)
geneExpressionData <- read.delim("Hypoxia-data-WGCNA.txt", as.is = T)
install.packages(c("fields", "impute", "dynamicTreeCut", "qvalue", "flashClust", "Hmisc") )
library(topGO)
library(org.Hs.eg.db)
library(WGCNA)
library(RCy3)
#uncomment if not yet installed!
BiocManager::install(c("topGO", "org.Hs.eg.db", "WGCNA", "RCy3", "igraph"))
install.packages("WGCNA")
?aov()
install.packages("BiocManager")
install.packages("BiocManager")
library(anamiR)
library(rstudioapi)
library(limma)
library(qvalue)
library(tidyverse)
# Get data in correct format
current_path <- getActiveDocumentContext()$path
setwd(dirname(current_path ))
mrna = read.delim('../Data/GeneExpressionNormalized.txt', check.names = FALSE) #Load expression data
mirna = read.delim('../Data/miRNAexpression.txt', check.names = FALSE)
mrna[is.na(mrna)] <- NA # Change all the NaNs to NA in the mRNA object.
key <- mrna[,1:2] # Key for maintaining gene symbol and entrez gene ID
#=== Here we change the columns names of mrna (mRNA samples) to the sample names ===
mrna = subset(mrna, select = -2) # Remove gene symbol column
columns = colnames(mrna)
columns[2:29] <- substr(unlist(columns[2:29]), 1, 6) #Only keep first 6 characters of column names
colnames(mrna) <- columns # Assign this to the actual column names
#=== Here we change the columns names of mirna (miRNA samples) to the sample names ===
labels = read.delim("../Data/colNames.csv", sep = ',', header = FALSE, colClasses = 'character')
columns = colnames(mirna)
columns[[1]] <- 'miRNA'
for (i in rep(2:length(colnames(mirna)))){
for ( j in rep(1:nrow(labels))){
if(colnames(mirna[i]) == labels[j,1]){
columns[[i]] = labels[j,3] # Assign correct column name to array
# print(labels[j,1])
# print(colnames(mirna[i]))
# print(labels[j, 3])
# print("======")
}
}
}
colnames(mirna) <- columns
#=== Here we initialise the sample grouping ===
sampleGroups <- read.delim("../Data/SampleGroups.csv", sep = ',', header = TRUE, colClasses = 'character')
sampleGroups <- sampleGroups[,6:7]
index_cholestatic <- sampleGroups == 'cholestatic'
sampleGroups$id[index_cholestatic[,1]] <- 1
index_drained <- sampleGroups == 'drained'
sampleGroups$id[index_drained[,1]] <- 2
index_control <- sampleGroups == 'control'
sampleGroups$id[index_control[,1]] <- 3
#======== For mRNA ===================#
design_matrix_mrna <- model.matrix(~ 0 + factor(c(1,1,1,1,1,1,1,1,1,
2,2,2,2,2,2,2,2,2,2,
3,3,3,3,3,3,3,3,3)))
colnames(design_matrix_mrna) <- c("cholestasis", "drained", "control")
cont_matrix <- makeContrasts (drained_v_control = drained - control,
cholestasis_v_control = cholestasis - control,
cholestasis_v_drained = cholestasis - drained,
levels = design_matrix_mrna)
fit <- lmFit(mrna[, 2:29], design_matrix_mrna)
fit_contrast <- contrasts.fit(fit, cont_matrix)
fit_contrast <- eBayes(fit_contrast)
results <- decideTests(fit_contrast)
summary(results)
top_genes <- topTable (fit_contrast, p.value = "0.05", number = nrow(mrna), adjust = "BH")
for (i in 1:ncol(fit_contrast)){
volcanoplot(fit_contrast[,i], main= colnames(fit_contrast)[i], col=ifelse(fit_contrast[,i]$p.value > 0.05,"red","black"))
abline(-log10(0.05),0)
abline(v=log2(2))
abline(v=-log2(2))
}
design_matrix <- model.matrix(~ 0 + factor(sampleGroups$id))
colnames(design_matrix) <- c("cholestasis", "drained", "control")
cont_matrix <- makeContrasts (drained_v_control = drained - control,
cholestasis_v_control = cholestasis - control,
cholestasis_v_drained = cholestasis - drained,
levels = design_matrix)
fit2 <- lmFit(mirna[, 2:29], design_matrix)
fit_contrast2 <- contrasts.fit(fit2, cont_matrix)
fit_contrast2 <- eBayes(fit_contrast2)
results2 <- decideTests(fit_contrast2)
summary(results2)
top_genes2 <- topTable (fit_contrast2, p.value = "0.05", number = nrow(mirna), adjust = "BH")
for (i in 1:ncol(fit_contrast2)){
volcanoplot(fit_contrast2[,i], main= colnames(fit_contrast2)[i], col=ifelse(fit_contrast2[,i]$p.value > 0.05,"red","black"))
abline(-log10(0.05),0)
abline(v=log2(2))
abline(v=-log2(2))
}
mrna_drained_v_control_pvalue <- qvalue(fit_contrast$p.value[,1])
mrna_cholestasis_v_control_pvalue <- qvalue(fit_contrast$p.value[,2])
mrna_cholestasis_v_drained_pvalue <- qvalue(fit_contrast$p.value[,3])
# Adjust all p values using qvalue() for the miRNA set
mirna_drained_v_control_pvalue <- qvalue(fit_contrast2$p.value[,1])
mirna_cholestasis_v_control_pvalue <- qvalue(fit_contrast2$p.value[,2])
mirna_cholestasis_v_drained_pvalue <- qvalue(fit_contrast2$p.value[,3])
cont_matrix <- makeContrasts (drained_v_control = drained - control,
levels = design_matrix)
fit2 <- lmFit(mirna[, 2:29], design_matrix)
fit_contrast2 <- contrasts.fit(fit2, cont_matrix)
fit_contrast2 <- eBayes(fit_contrast2)
results2 <- decideTests(fit_contrast2)
summary(results2)
top_genes2 <- topTable (fit_contrast2, number = nrow(mirna), adjust = "BH")
mrna_batch_410978 <- mrna[, c(2, 5, 3, 4, 7, 6, 8, 9), drop=F]
mrna_batch_410979 <- mrna[, c(12, 15, 17, 10, 13, 16, 11, 14), drop=F]
mrna_batch_410980 <- mrna[, c(20, 23, 18, 21, 24, 19, 22, 25), drop=F]
mrna_batch_412287 <- mrna[, c(26, 28, 27, 29), drop=F]
y2 <- removeBatchEffect(batch_410978, batch_410979)
par(mfrow=c(1,2))
boxplot(as.data.frame(batch_410978),main="Original")
boxplot(as.data.frame(y2),main="Batch corrected")
controls<- subset(sampleGroups, Treatment== "control")
cholestatic<- subset(sampleGroups, Treatment== "cholestatic")
drained<- subset(sampleGroups, Treatment== "drained")
drained_mrna<-mrna[match(drained$SampleName, colnames(mrna))]
cholestatic_mrna<-mrna[match(cholestatic$SampleName, colnames(mrna))]
controls_mrna<-mrna[match(controls$SampleName, colnames(mrna))]
labels_2<-labels[,2:3] # get treatment and mrna id
data_long<-stack(mrna[,2:29],colnames(mrna[,2:29])) # data in long format
merged_data<- merge(data_long, labels_2$V2) # merge dataset. Can take a few min.
merged_data<- subset(merged_data, select=c("values","y")) # then select only the colums of the expression and the treatment.
require(limma)
require(pcaMethods)
require(gplots)
require(ggplot2)
library(FactoMineR)
library(factoextra)
# MIRNA pca for 28 samples
mirna[is.na(mirna)] <- NA # change Nan for NA
pcaRes <- pca(t(mirna[,2:29]),nPcs = 10)  # perform PCA
PCA_28mirna<- data.frame(c(pcaRes@scores[,1]),
pcaRes@scores[,2],
pcaRes@scores[,3],
pcaRes@scores[,4],
pcaRes@scores[,5],
treat=labels$V2)
colnames(PCA_28mirna) = c("PCA1", "PCA2", "PCA3","PCA4", "PCA5", "treat")
ggplot(PCA_28mirna, aes(x = PCA1, y = PCA2)) +
geom_point(aes(colour = PCA_28mirna$treat)) +
scale_colour_manual(values = c("#04179b", "#da9e00", "#198c19"),
aesthetics = "fill") +
theme_light()
mean<- mrna[,2:29]
View(mean)
#=========================================#
# 5. ANOVA
#==========================================#
mean<- mean(mrna[,2:29])
?mean()
?mean()
#=========================================#
# 5. ANOVA
#==========================================#
mean<- colmean(mrna[,2:29])
#=========================================#
# 5. ANOVA
#==========================================#
mean<- rowMeans(t(mrna[,2:29])
labels_2<-labels[,2:3] # get treatment and mrna id
labels[,2:3]
View(sampleGroups)
#=========================================#
# 5. ANOVA
#==========================================#
mean<- data.frame(rowMeans(t(mrna[,2:29]))
#=========================================#
# 5. ANOVA
#==========================================#
mean<- data.frame(rowMeans(t(mrna[,2:29])))
#=========================================#
# 5. ANOVA
#==========================================#
means<- data.frame(rowMeans(t(mrna[,2:29])))
View(means)
mrna[,2:29]
rowMeans(t(mrna[,2:29]))
View(means)
#=========================================#
# 5. ANOVA
#==========================================#
means<- data.frame(rowMeans(t(mrna[,2:29]),na.rm = TRUE))
aov(mrna~means)
View(means)
#=========================================#
# 5. ANOVA
#==========================================#
means<- data.frame(means=rowMeans(t(mrna[,2:29]),na.rm = TRUE))
View(means)
View(mrna)
View(sampleGroups)
#=========================================#
# 5. ANOVA
#==========================================#
means<- data.frame(means=rowMeans(t(mrna[,2:29]),na.rm = TRUE))
batch<- sampleGroups$Treatment
aov(batch~means, data=mrna)
aov(batch~means)
anova_Test<- aov(batch~means)
anova_Test<- aov(mean~batch)
#=========================================#
# 5. ANOVA
#==========================================#
means<- rowMeans(t(mrna[,2:29]),na.rm = TRUE))
batch<- sampleGroups$Treatment
#=========================================#
# 5. ANOVA
#==========================================#
means<- rowMeans(t(mrna[,2:29]),na.rm = TRUE)
batch<- sampleGroups$Treatment
anova_Test<- aov(mean~batch)
#=========================================#
# 5. ANOVA
#==========================================#
means<- data.frame(rowMeans(t(mrna[,2:29]),na.rm = TRUE))
batch<- data.frame(sampleGroups$Treatment)
anova_Test<- aov(mean~batch)
View(batch)
#=========================================#
# 5. ANOVA
#==========================================#
means<- rowMeans(t(mrna[,2:29]),na.rm = TRUE)
batch<- sampleGroups$Treatment
anova_Test<- aov(mean~batch)
batch
#=========================================#
# 5. ANOVA
#==========================================#
means<- rowMeans(t(mrna[,2:29]),na.rm = TRUE)
batch<- sampleGroups$id
anova_Test<- aov(mean~batch)
batch<- subset(sampleGroups, c(1,2))
batch<- sampleGroups$Treatment
rownames(batch)<- sampleGroups$SampleName
batch<- data.frame(sampleGroups$Treatment)
rownames(batch)<- sampleGroups$SampleName
View(batch)
#=========================================#
# 5. ANOVA
#==========================================#
means<- rowMeans(t(mrna[,2:29]),na.rm = TRUE)
batch_number_mrna
mrna = read.delim('../Data/GeneExpressionNormalized.txt', check.names = FALSE) #Load expression data
mrna = subset(mrna, select = -2) # Remove gene symbol column
names_mrna = colnames(mrna[,2:length(mrna)]) #
batch_number_mrna <- data.frame(Batch_num= substr(unlist(names_mrna), 8, 13)) #Only keep the batch number
batch<- batch_number_mrna
View(batch_number_mrna)
#=========================================#
# 5. ANOVA
#==========================================#
means<- rowMeans(t(mrna[,2:29]),na.rm = TRUE)
#=========================================#
# 5. ANOVA
#==========================================#
means<- rowMeans(t(mrna[,2:29]),na.rm = TRUE)
anova_Test<- aov(mean~as.vector(batch_number_mrna))
anova_Test<- aov(mean~batch_number_mrna)
#=========================================#
# 5. ANOVA
#==========================================#
means<- rowMeans(t(mrna[,2:29]),na.rm = TRUE)
batch_number_mrna
as.vector(batch_number_mrna)
typeof(as.vector(batch_number_mrna))
typeof(as.vector(batch_number_mrna))
batch<-batch_number_mrna
batch<-as.vector(batch_number_mrna)
batch<-as.vector(batch_number_mrna)
View(batch)
#=========================================#
# 5. ANOVA
#==========================================#
means<- rowMeans(t(mrna[,2:29]),na.rm = TRUE)
typeof(means)
#=========================================#
# 5. ANOVA
#==========================================#
means<- data.frame(rowMeans(t(mrna[,2:29]),na.rm = TRUE))
View(means)
batch<-batch_number_mrna
View(batch)
anova_Test<- aov(mean~batch_number_mrna)
batch<-batch_number_mrna
anova_Test<- aov(mean~batch)
batch
anova_Test<- aov(means~batch)
means
as.numeric(means)
means[,1]
typeof(means[,1])
anova_Test<- aov(means[,1]~batch[,1])
View(anova_Test)
summary(anova_Test)
anova_Test<- aov(batch[,1]~means[,1])
summary(anova_Test)
batch<-batch_number_mrna
anova_Test<- aov(batch[,1]~means[,1])
summary(anova_Test)
batch<-batch_number_mrna
anova_Test<- aov(means[,1]~batch[,1])
summary(anova_Test)
View(anova_Test)
View(anova_Test)
View(anova_Test)
means[,1]
?TukeyHSD()
TukeyHSD(anova_Test, ordered = FALSE, conf.level = 0.95)
batch_number_mrna <- data.frame(Batch_num= substr(unlist(names_mrna), 8, 13)) #Only keep the batch number
View(batch_number_mrna)
batch_number_mrna <- data.frame(Batch_num= substr(unlist(names_mrna), 8, 13)) #Only keep the batch number
name_batches<- unique(batch_number_mrna)
View(batch_number_mrna)
mirna = read.delim('../Data/miRNAexpression.txt', check.names = FALSE)
View(mirna)
mrna = read.delim('../Data/GeneExpressionNormalized.txt', check.names = FALSE) #Load expression data
View(mrna)
colnames(mrna)
colnames(mrna)[10]<-"FGS_10_410978_2_3_H"
View(mrna)
removeBatchEffect
?removeBatchEffect
mrna_batch_410978 <- mrna[, c(2, 5, 3, 4, 7, 6, 8, 9), drop=F]
mrna_batch_410979 <- mrna[, c(12, 15, 17, 10, 13, 16, 11, 14), drop=F]
mrna_batch_410980 <- mrna[, c(20, 23, 18, 21, 24, 19, 22, 25), drop=F]
mrna_batch_412287 <- mrna[, c(26, 28, 27, 29), drop=F]
View(mrna_batch_410978)
y2 <- removeBatchEffect(batch_410978, batch_410980)
y2 <- removeBatchEffect(mrna_batch_410978, mrna_batch_410980)
View(mrna_batch_410978)
y2 <- removeBatchEffect(mrna_batch_410978[,2:29], mrna_batch_410980[,2:29])
View(mrna_batch_410978)
y2 <- removeBatchEffect(mrna_batch_410978[,2:length(mrna_batch_410978)], mrna_batch_410980[,2:length(mrna_batch_410980)])
par(mfrow=c(1,2))
boxplot(as.data.frame(batch_410978),main="Original")
boxplot(as.data.frame(y2),main="Batch corrected")
y2 <- removeBatchEffect(mrna_batch_410978[,2:length(mrna_batch_410978)], mrna_batch_410980[,2:length(mrna_batch_410980)])
par(mfrow=c(1,2))
boxplot(as.data.frame(mrna_batch_410978),main="Original")
boxplot(as.data.frame(y2),main="Batch corrected")
y2 <- removeBatchEffect(mrna[,2:29], mrna_batch_410978[,2:length(mrna_batch_410978)], mrna_batch_410980[,2:length(mrna_batch_410980)])
par(mfrow=c(1,2))
boxplot(as.data.frame(mrna_batch_410978),main="Original")
boxplot(as.data.frame(y2),main="Batch corrected")
boxplot(as.data.frame(mrna),main="Original")
boxplot(as.data.frame(y2),main="Batch corrected")
boxplot(as.data.frame(mrna[,2:29]),main="Original")
boxplot(as.data.frame(y2),main="Batch corrected")
boxplot(as.data.frame(mrna[,3:29]),main="Original")
boxplot(as.data.frame(y2),main="Batch corrected")
# MIRNA pca for 28 samples
mirna[is.na(mirna)] <- NA # change Nan for NA
pcaRes <- pca(t(mirna[,2:29]),nPcs = 10)  # perform PCA
PCA_28mirna<- data.frame(c(pcaRes@scores[,1]),
pcaRes@scores[,2],
pcaRes@scores[,3],
pcaRes@scores[,4],
pcaRes@scores[,5],
treat=labels$V2)
colnames(PCA_28mirna) = c("PCA1", "PCA2", "PCA3","PCA4", "PCA5", "treat")
ggplot(PCA_28mirna, aes(x = PCA1, y = PCA2)) +
geom_point(aes(colour = PCA_28mirna$treat)) +
scale_colour_manual(values = c("#04179b", "#da9e00", "#198c19"),
aesthetics = "fill") +
theme_light()
mrna = read.delim('../Data/GeneExpressionNormalized.txt', check.names = FALSE) #Load expression data
mrna = subset(mrna, select = -2) # Remove gene symbol column
names_mrna = colnames(mrna[,2:length(mrna)]) #
batch_number_mrna <- data.frame(Batch_num= substr(unlist(names_mrna), 8, 13)) #Only keep the batch number
name_batches<- unique(batch_number_mrna)
mrna[is.na(mrna)] <- NA # change Nan for NA
pcaRes2 <- pca(t(mrna[,2:29]),nPcs = 10)  # perform PCA
PCA_28mrna<- data.frame(c(pcaRes2@scores[,1]),
pcaRes2@scores[,2],
pcaRes2@scores[,3],
pcaRes2@scores[,4],
pcaRes2@scores[,5],
batch= batch_number_mrna)
colnames(PCA_28mrna) = c("PCA1", "PCA2", "PCA3","PCA4", "PCA5", "Batches")
ggplot(PCA_28mrna, aes(x = PCA1, y = PCA2)) +
geom_point(aes(colour = PCA_28mrna$Batches)) +
scale_colour_manual(values = c("#04179b", "#da9e00", "#198c19","#66049b"),
aesthetics = "fill") +
theme_light()
