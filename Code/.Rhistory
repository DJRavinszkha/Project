?c()
ls()
setRepositories(FALSE, 1:9)
install.packages(c('gplots', 'limma', 'pcaMethods'))
ls()
setRepositories(FALSE, 1:9)
install.packages(c('gplots', 'limma', 'pcaMethods'))
library(pcaMethods)
library(limma)
boxplot()
gxData.raw
boxplot()
boxplot()
ls()
library(gtools)
# 1.1 Import the text file containing the data into a new object 'gxData.raw'
#----------------------------------------------------------------------------#
# HINT: use the first column as rownames in your object.
setwd(DATA.DIR)
# 1.1 Import the text file containing the data into a new object 'gxData.raw'
#----------------------------------------------------------------------------#
# HINT: use the first column as rownames in your object.
setwd(DATA.DIR)
## STEP 1: Set working directory to MSB1005-WGCNA-2019 folder.
Change location to current file location
```{r}
library(rstudioapi)
current_path <- getActiveDocumentContext()$path
setwd(dirname(current_path ))
```
```{r}
library(rstudioapi)
install.packages(c("BiocManager", "igraph", "rstudioapi", "WGCNA"))
```{r}
library(rstudioapi)
current_path <- getActiveDocumentContext()$path
setwd(dirname(current_path ))
library(rstudioapi)
current_path <- getActiveDocumentContext()$path
setwd(dirname(current_path ))
## STEP 2: Packages
Install the required packages if necessary
```{r}
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
#uncomment if not yet installed!
BiocManager::install(c("topGO", "org.Hs.eg.db", "WGCNA", "RCy3", "igraph"))
library(topGO)
library(org.Hs.eg.db)
library(WGCNA)
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
#uncomment if not yet installed!
BiocManager::install(c("topGO", "org.Hs.eg.db", "WGCNA", "RCy3", "igraph"))
library(topGO)
library(org.Hs.eg.db)
library(WGCNA)
install.packages("WGCNA")
install.packages("WGCNA")
source("http://bioconductor.org/biocLite.R")
biocLite("impute")
BiocManager::install("WGCNA")
library(topGO)
library(org.Hs.eg.db)
library(WGCNA)
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
#uncomment if not yet installed!
BiocManager::install(c("topGO", "org.Hs.eg.db", "WGCNA", "RCy3", "igraph"))
#uncomment if not yet installed!
BiocManager::install(c("topGO", "org.Hs.eg.db", "WGCNA", "RCy3", "igraph"))
library(topGO)
library(org.Hs.eg.db)
#library(WGCNA
library(RCy3
library(igraph
library(WGCNA)
library(RCy3)
library(igraph)
options(stringsAsFactors = F)
geneExpressionData <- read.delim("Hypoxia-data-WGCNA.txt", as.is = T)
install.packages(c("fields", "impute", "dynamicTreeCut", "qvalue", "flashClust", "Hmisc") )
library(topGO)
library(org.Hs.eg.db)
library(WGCNA)
library(RCy3)
#uncomment if not yet installed!
BiocManager::install(c("topGO", "org.Hs.eg.db", "WGCNA", "RCy3", "igraph"))
install.packages("WGCNA")
airquality
library(anamiR)
library(rstudioapi)
library(limma)
library(qvalue)
library(tidyverse)
# Get data in correct format
current_path <- getActiveDocumentContext()$path
setwd(dirname(current_path ))
mrna = read.delim('../Data/GeneExpressionNormalized.txt', check.names = FALSE) #Load expression data
mirna = read.delim('../Data/miRNAexpression.txt', check.names = FALSE)
mrna[is.na(mrna)] <- NA # Change all the NaNs to NA in the mRNA object.
key <- mrna[,1:2] # Key for maintaining gene symbol and entrez gene ID
#=== Here we change the columns names of mrna (mRNA samples) to the sample names ===
mrna = subset(mrna, select = -2) # Remove gene symbol column
columns = colnames(mrna)
columns[2:29] <- substr(unlist(columns[2:29]), 1, 6) #Only keep first 6 characters of column names
colnames(mrna) <- columns # Assign this to the actual column names
#=== Here we change the columns names of mirna (miRNA samples) to the sample names ===
labels = read.delim("../Data/colNames.csv", sep = ',', header = FALSE, colClasses = 'character')
columns = colnames(mirna)
columns[[1]] <- 'miRNA'
for (i in rep(2:length(colnames(mirna)))){
for ( j in rep(1:nrow(labels))){
if(colnames(mirna[i]) == labels[j,1]){
columns[[i]] = labels[j,3] # Assign correct column name to array
# print(labels[j,1])
# print(colnames(mirna[i]))
# print(labels[j, 3])
# print("======")
}
}
}
colnames(mirna) <- columns
#=== Here we initialise the sample grouping ===
sampleGroups <- read.delim("../Data/SampleGroups.csv", sep = ',', header = TRUE, colClasses = 'character')
sampleGroups <- sampleGroups[,6:7]
index_cholestatic <- sampleGroups == 'cholestatic'
sampleGroups$id[index_cholestatic[,1]] <- 1
index_drained <- sampleGroups == 'drained'
sampleGroups$id[index_drained[,1]] <- 2
index_control <- sampleGroups == 'control'
sampleGroups$id[index_control[,1]] <- 3
#======== For mRNA ===================#
design_matrix_mrna <- model.matrix(~ 0 + factor(c(1,1,1,1,1,1,1,1,1,
2,2,2,2,2,2,2,2,2,2,
3,3,3,3,3,3,3,3,3)))
colnames(design_matrix_mrna) <- c("cholestasis", "drained", "control")
cont_matrix <- makeContrasts (drained_v_control = drained - control,
cholestasis_v_control = cholestasis - control,
cholestasis_v_drained = cholestasis - drained,
levels = design_matrix_mrna)
fit <- lmFit(mrna[, 2:29], design_matrix_mrna)
fit_contrast <- contrasts.fit(fit, cont_matrix)
fit_contrast <- eBayes(fit_contrast)
results <- decideTests(fit_contrast)
summary(results)
top_genes <- topTable (fit_contrast, p.value = "0.05", number = nrow(mrna), adjust = "BH")
for (i in 1:ncol(fit_contrast)){
volcanoplot(fit_contrast[,i], main= colnames(fit_contrast)[i], col=ifelse(fit_contrast[,i]$p.value > 0.05,"red","black"))
abline(-log10(0.05),0)
abline(v=log2(2))
abline(v=-log2(2))
}
design_matrix <- model.matrix(~ 0 + factor(sampleGroups$id))
colnames(design_matrix) <- c("cholestasis", "drained", "control")
cont_matrix <- makeContrasts (drained_v_control = drained - control,
cholestasis_v_control = cholestasis - control,
cholestasis_v_drained = cholestasis - drained,
levels = design_matrix)
fit2 <- lmFit(mirna[, 2:29], design_matrix)
fit_contrast2 <- contrasts.fit(fit2, cont_matrix)
fit_contrast2 <- eBayes(fit_contrast2)
results2 <- decideTests(fit_contrast2)
summary(results2)
top_genes2 <- topTable (fit_contrast2, p.value = "0.05", number = nrow(mirna), adjust = "BH")
for (i in 1:ncol(fit_contrast2)){
volcanoplot(fit_contrast2[,i], main= colnames(fit_contrast2)[i], col=ifelse(fit_contrast2[,i]$p.value > 0.05,"red","black"))
abline(-log10(0.05),0)
abline(v=log2(2))
abline(v=-log2(2))
}
mrna_drained_v_control_pvalue <- qvalue(fit_contrast$p.value[,1])
mrna_cholestasis_v_control_pvalue <- qvalue(fit_contrast$p.value[,2])
mrna_cholestasis_v_drained_pvalue <- qvalue(fit_contrast$p.value[,3])
# Adjust all p values using qvalue() for the miRNA set
mirna_drained_v_control_pvalue <- qvalue(fit_contrast2$p.value[,1])
mirna_cholestasis_v_control_pvalue <- qvalue(fit_contrast2$p.value[,2])
mirna_cholestasis_v_drained_pvalue <- qvalue(fit_contrast2$p.value[,3])
cont_matrix <- makeContrasts (drained_v_control = drained - control,
levels = design_matrix)
fit2 <- lmFit(mirna[, 2:29], design_matrix)
fit_contrast2 <- contrasts.fit(fit2, cont_matrix)
fit_contrast2 <- eBayes(fit_contrast2)
results2 <- decideTests(fit_contrast2)
summary(results2)
top_genes2 <- topTable (fit_contrast2, number = nrow(mirna), adjust = "BH")
mrna_batch_410978 <- mrna[, c(2, 5, 3, 4, 7, 6, 8, 9), drop=F]
mrna_batch_410979 <- mrna[, c(12, 15, 17, 10, 13, 16, 11, 14), drop=F]
mrna_batch_410980 <- mrna[, c(20, 23, 18, 21, 24, 19, 22, 25), drop=F]
mrna_batch_412287 <- mrna[, c(26, 28, 27, 29), drop=F]
y2 <- removeBatchEffect(batch_410978, batch_410979)
par(mfrow=c(1,2))
boxplot(as.data.frame(batch_410978),main="Original")
boxplot(as.data.frame(y2),main="Batch corrected")
controls<- subset(sampleGroups, Treatment== "control")
cholestatic<- subset(sampleGroups, Treatment== "cholestatic")
drained<- subset(sampleGroups, Treatment== "drained")
drained_mrna<-mrna[match(drained$SampleName, colnames(mrna))]
cholestatic_mrna<-mrna[match(cholestatic$SampleName, colnames(mrna))]
controls_mrna<-mrna[match(controls$SampleName, colnames(mrna))]
data_long<-stack(sampleGroups$SampleName,sampleGroups$Treatment) # change data to format long
data_long<-stack(sampleGroups$SampleName,sampleGroups$Treatment) # change data to format long
?stack
data_long<-stack(sampleGroups,sampleGroups$Treatment) # change data to format long
data_long<-stack(sampleGroups,sampleGroups$SampleName) # change data to format long
sampleGroups$SampleName
data_long<-stack(sampleGroups,SampleName) # change data to format long
View(data_long)
data_long<-stack(sampleGroups,"SampleName") # change data to format long
View(data_long)
View(labels)
data_long<-labels[,2:3]
View(data_long)
data_long<-stack(mrna[,2:29],colnames(mrna))
labels_2<-labels[,2:3]
data_long<-stack(mrna[,2:29],colnames(mrna))
data_long<-stack(mrna[,2:29],colnames(mrna[,2:29]))
View(data_long)
merged_data<- merge(data_long, labels_2)
View(merged_data)
labels_2<-labels[,2:3]
data_long<-stack(mrna[,2:29],colnames(mrna[,2:29]))
merged_data<- match(data_long, labels_2)
View(data_long)
merged_data<- merge(data_long, labels_2$V2)
View(merged_data)
merged_data<- c(-2)
merged_data<- merged_data[-2]
merged_data<- merged_data[,-2]
merged_data<- merge(data_long, labels_2$V2)
View(merged_data)
merged_data<- subset(merged_data, select=c("values","y"))
View(merged_data)
control_vs_chole<- pairwise.t.test(merged_data$values,merged_data$y, p.adjust.method = "BH") #ask the group about how to make the comparison between the different groups
View(control_vs_chole)
View(control_vs_chole)
